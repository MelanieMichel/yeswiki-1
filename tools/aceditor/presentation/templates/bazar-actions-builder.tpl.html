<div class="modal fade" id="bazar-actions-modal" tabindex="-1" role="dialog" >
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
        <h2 class="modal-title"><?php echo _t('ACEDITOR_ACTIONS_BAZAR'); ?></h2>
      </div>

      <!-- Modal Body -->
      <div id="bazar-actions-builder-app" class="modal-body">
        <!-- Choose form -->
        <div class="form-group">
          <label class="control-label"><?php echo _t('ACTION_BUILDER_CHOOSE_FORM'); ?></label>
          <select v-model="selectedFormId" required class="form-control">
            <option v-for="(name, id) in formIds" :value="id">{{ name }}</option>
          </select>
        </div>

        <!-- Choose Bazar Action -->
        <div class="form-group">
          <label class="control-label"><?php echo _t('ACTION_BUILDER_CHOOSE_ACTION'); ?></label>
          <select v-model="selectedActionId" required class="form-control">
            <option v-for="(action, actionId) in actions" :value="actionId">{{ action.label }}</option>
          </select>
        </div>

        <!-- Action Parameters -->
        <div v-if="selectedAction" class="row" class="action-parameters-container">
          <div class="col-md-12">
            <div class="alert alert-info">{{ selectedAction.description }}</div>
          </div>

          <div class="col-md-2">
            <h3><?php echo _t('ACTION_BUILDER_PARAMETERS') ?></h3>
            <div class="form-group" v-for="(property, propName) in selectedAction.properties">
                <label v-if="property.label" class="control-label">{{ property.label }}</label>
                <!-- Text Property -->
                <template v-if="property.type == 'text'">
                  <input type="text" v-model="values[propName]" class="form-control" :required="property.required"/>
                </template>
                <!-- Number Property -->
                <template v-if="property.type == 'number'">
                  <input type="number" v-model="values[propName]" class="form-control" :required="property.required" :min="property.min" :max="property.max"/>
                </template>
                <!-- List Property -->
                <template v-else-if="property.type == 'list'">
                  <select class="form-control" v-model="values[propName]" :required="property.required">
                    <option v-for="option in property.options" :value="option" >{{ option }}</option>
                  </select>
                </template>
                <!-- Other Property -->
                <template v-else>
                  <input type="hidden" v-model="values[propName]" />
                </template>
            </div>
          </div>

          <div class="col-md-6 widget-iframe-container">
            <h3>Preview (non clickable)</h3>
            <iframe class="iframe-preview" width="200%" height="500px" frameborder="0" :src="previewIframeUrl"></iframe>
            <div class="iframe-blocker"></div>
          </div>

          <div class="col-md-4 filter-parameters-container">
            <h3>Filtres / Recherche</h3>

            <label>
              <input type="checkbox" v-model="values.search" />
              <span>Barre de recherche</span>
            </label>

            <div class="form-group">
              <label class="control-label">Nombre de fiches par page</label>
              <input type="number" v-model="values.pagination" class='form-control' />
            </div>

            <label>
              <input type="checkbox" v-model="showFiltersConfig"/>
              <span>Filtrer avec des Facettes</span>
            </label>

            <!-- Facettes Config -->
            <template v-if="showFiltersConfig">
              <div class="filter-group-form" v-if="selectedForm" v-for="filter in filterGroups">
                <div class="col-sm-4 form-group">
                  <label class="control-label">Champ</label>
                  <select v-model="filter.field" class="form-control">
                    <option v-for="field in selectedForm.prepared" :value="field.id">{{ field.label }} - {{ field.id }}</option>
                  </select>
                </div>
                <div v-if="selectedForm" class="col-sm-4 form-group">
                  <label class="control-label">Titre</label>
                  <input type="text" v-model="filter.title" class="form-control" />
                </div>
                <div v-if="selectedForm" class="col-sm-3 form-group">
                  <label class="control-label">Icone </label>
                  <input type="text" v-model="filter.icon" class="form-control" />
                </div>
                <div class="form-group col-sm-1">
                  <i class="btn-remove-group fa fa-times" @click="removeFilterGroup(filter)"></i>
                </div>

              </div>
              <button v-if="selectedForm" @click="addEmptyFilterGroup" class="btn btn-info btn-add-group">Ajouter une Facette</button>

              <div class="form-group">
                <label class="control-label">Affichage initial des facettes</label>
                <select v-model="values.groupsexpanded" class="form-control">
                    <option value="0">Non dépliées</option>
                    <option value="1">Dépliées</option>
                </select>
              </div>
              <div class="form-group">
                <label class="control-label">Position des facettes</label>
                <select v-model="values.filterposition" class="form-control">
                    <option value="right">Droite</option>
                    <option value="left">Gauche</option>
                </select>
              </div>
              <div class="form-group">
                <label class="control-label">Largeur des facettes (1 à 12)</label>
                <input type="number" min="1" max="12" v-model="values.filtercolsize" class="form-control"/>
              </div>
            </template>
          </div>

          <!-- vue="rechercher" voirmenu="0" -->
          <!-- groups="Nomduneliste,duchamp"  titles="titredelaliste, duchamp" pagination="15" -->
          <!-- vue="consulter" voirmenu="0" groups="Nomduneliste,duchamp"  titles="titredelaliste, duchamp" pagination="15" -->

          <div class="col-md-12 result-container">
            <h3><?php echo _t('ACTION_BUILDER_WIKI_CODE_TITLE') ?></h3>
            <div class="input-group">
              <div class="input-group-addon btn btn-primary" @click="copyContent"><?php echo _t('ACTION_BUILDER_COPY') ?></div>
              <input type="text" class="result form-control" @click="selectFullText" :value="wikiCode" ref="wikiCode">
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-default btn-block" data-dismiss="modal">Close</button>
      </div>

    </div>
  </div>
</div>

<script>
  // Not very elegant, but avoid doing an ajax request from vue component to retrieve the Json data
  var data = <?php echo json_encode($data) ?>;
</script>

<?php
  // $GLOBALS['wiki']->addJavascriptFile('libs/vue.min.js');
  $GLOBALS['wiki']->addJavascriptFile('libs/vue.js'); // For dev only
  $GLOBALS['wiki']->addJavascriptFile('tools/aceditor/presentation/javascripts/bazar-actions-builder.js');
  $GLOBALS['wiki']->addCSSFile('tools/aceditor/presentation/styles/bazar-actions-builder.css');
?>
